<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <script src="jquery/jquery-3.3.1.slim.min.js"></script>
    <script src="popper/popper.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    
    <script src="dygraph/dygraph.js"></script>
    <link rel="stylesheet" href="dygraph/dygraph.css" />
    
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="graph_server"></div>
    <script>
      g = new Dygraph(
        document.getElementById("graph_server"),
        "http://192.168.0.150:3388/data/pc-data-2019-03.csv",
        {
          // Základní věci.
          title: "Server (Arch Linux)",
          legend: "always",
          animatedZooms: false,
          labelsSeparateLines: true,
          drawPoints: true,
          
          // Zobrazit jen poslední hodinu.
          dateWindow: [ new Date(new Date() - 60*60*1000),
                        new Date() ],
          
          // Podvýběr X-ové osy.
          showRangeSelector: true,
          rangeSelectorHeight: 40,
          rangeSelectorPlotFillColor: 'MediumSlateBlue',
          rangeSelectorPlotFillGradientColor: 'rgba(123, 104, 238, 0)',
          colorValue: 0.9,
          fillAlpha: 0.4,
          
          series : {
            'CpuTemp': { axis: 'y' },
            'MemoryPerc': { axis: 'y2' }
          },
          
          axes: {
            y: {
              valueFormatter: function(v) {
                return v + ' °C';
              },
              axisLabelFormatter: function(v) {
                return v + ' °C';
              }
            },
            y2: {
              valueFormatter: function(v) {
                return v + ' %';
              },
              axisLabelFormatter: function(v) {
                return v + ' %';
              }
            },
          },
        });
    </script>
    
    <div id="graph_test"></div>
    <script>
      g = new Dygraph(
        document.getElementById("graph_test"),
        "http://192.168.0.150:3388/data/sample-data.csv",
        {
          // Základní věci.
          title: "Temperature",
          legend: "always",
          animatedZooms: false,
          labelsSeparateLines: true,
          drawPoints: true,
          
          // Zobrazit jen poslední 4 dny.
          dateWindow: [ new Date(new Date() - 4*24*60*60*1000),
                        new Date() ],
          
          // Podvýběr X-ové osy.
          showRangeSelector: true,
          rangeSelectorHeight: 40,
          rangeSelectorPlotFillColor: 'MediumSlateBlue',
          rangeSelectorPlotFillGradientColor: 'rgba(123, 104, 238, 0)',
          colorValue: 0.9,
          fillAlpha: 0.4,
          
          series : {
            'Temp': { axis: 'y' },
            'Humidity': { axis: 'y2' }
          },
          
          axes: {
            y: {
              valueFormatter: function(v) {
                return v + ' °C';
              },
              axisLabelFormatter: function(v) {
                return v + ' °C';
              }
            },
            y2: {
              valueFormatter: function(v) {
                return Math.round(v, 1) + ' %';
              },
              axisLabelFormatter: function(v) {
                return Math.round(v, 1) + ' %';
              }
            },
          },
          
          // Zvýraznění víkendů.
          underlayCallback: function(canvas, area, g) {
            canvas.fillStyle = "rgba(255, 255, 102, 1.0)";
      
            function highlight_period(x_start, x_end) {
              var canvas_left_x = g.toDomXCoord(x_start);
              var canvas_right_x = g.toDomXCoord(x_end);
              var canvas_width = canvas_right_x - canvas_left_x;
              canvas.fillRect(canvas_left_x, area.y, canvas_width, area.h);
            }
      
            var min_data_x = g.getValue(0,0);
            var max_data_x = g.getValue(g.numRows()-1,0);
      
            // get day of week
            var d = new Date(min_data_x);
            var dow = d.getUTCDay();
      
            var w = min_data_x;
            // starting on Sunday is a special case
            if (dow === 0) {
              highlight_period(w,w+12*3600*1000);
            }
            // find first saturday
            while (dow != 6) {
              w += 24*3600*1000;
              d = new Date(w);
              dow = d.getUTCDay();
            }
            // shift back 1/2 day to center highlight around the point for the day
            w -= 12*3600*1000;
            while (w < max_data_x) {
              var start_x_highlight = w;
              var end_x_highlight = w + 2*24*3600*1000;
              // make sure we don't try to plot outside the graph
              if (start_x_highlight < min_data_x) {
                start_x_highlight = min_data_x;
              }
              if (end_x_highlight > max_data_x) {
                end_x_highlight = max_data_x;
              }
              highlight_period(start_x_highlight,end_x_highlight);
              // calculate start of highlight for next Saturday 
              w += 7*24*3600*1000;
            }
          }
        });
    </script>
  </body>
</html>